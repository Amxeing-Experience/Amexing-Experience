<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: presentation/routes/api/userManagementRoutes.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: presentation/routes/api/userManagementRoutes.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * User Management API Routes - RESTful endpoints for user CRUD operations
 * Provides Ajax-ready API endpoints with comprehensive security and validation.
 *
 * Features:
 * - RESTful API design
 * - Role-based access control middleware
 * - Request validation and sanitization
 * - Rate limiting and security headers
 * - Comprehensive error handling
 * - API documentation ready.
 * @author Amexing Development Team
 * @version 1.0.0
 * @since 2024-09-22
 */

const express = require('express');
const rateLimit = require('express-rate-limit');
const UserManagementController = require('../../../application/controllers/api/UserManagementController');
const jwtMiddleware = require('../../../application/middleware/jwtMiddleware');
const securityMiddleware = require('../../../infrastructure/security/securityMiddleware');
const logger = require('../../../infrastructure/logger');

const router = express.Router();
const userController = new UserManagementController();

// Rate limiting for user management operations
const userApiLimiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15 minutes
  max: 100, // Limit each IP to 100 requests per windowMs
  message: {
    success: false,
    error: 'Too many user management requests from this IP, please try again later.',
    retryAfter: '15 minutes',
  },
  standardHeaders: true,
  legacyHeaders: false,
});

// More restrictive rate limiting for write operations
const writeOperationsLimiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15 minutes
  max: 30, // Limit write operations
  message: {
    success: false,
    error: 'Too many user modification requests from this IP, please try again later.',
    retryAfter: '15 minutes',
  },
  standardHeaders: true,
  legacyHeaders: false,
});

// Apply rate limiting and authentication to all routes
router.use(userApiLimiter);
router.use(jwtMiddleware.authenticateToken);

/**
 * Get users with filtering, pagination, and role-based access.
 * Route: GET /api/users
 * Access: Private (authenticated users with appropriate permissions).
 * @param {object} req - Express request object with query parameters: page, limit, role, active, search, clientId, departmentId, sortField, sortDirection.
 * @param {object} res - Express response object.
 * @returns {Promise&lt;void>} Resolves when response is sent.
 * @example
   * // GET /api/endpoint
   * // Response: { "success": true, "data": [...] }
 * GET /api/users?page=1&amp;limit=10&amp;role=admin&amp;active=true
 */
router.get('/', async (req, res) => {
  await userController.getUsers(req, res);
});

/**
 * Search users with advanced filtering.
 * Route: GET /api/users/search
 * Access: Private (authenticated users with appropriate permissions).
 * @param {object} req - Express request object with query parameters: q (search term), role, active, page, limit, sortField, sortDirection.
 * @param {object} res - Express response object.
 * @returns {Promise&lt;void>} Resolves when response is sent.
 * @example
   * // GET /api/endpoint
   * // Response: { "success": true, "data": [...] }
 * GET /api/users/search?q=john&amp;role=employee&amp;active=true
 */
router.get('/search', async (req, res) => {
  await userController.searchUsers(req, res);
});

/**
 * Get user statistics for dashboard.
 * Route: GET /api/users/statistics
 * Access: Private (superadmin, admin).
 * @param {object} req - Express request object.
 * @param {object} res - Express response object.
 * @returns {Promise&lt;void>} Resolves when response is sent.
 * @example
   * // GET /api/endpoint
   * // Response: { "success": true, "data": [...] }
 * GET /api/users/statistics
 */
router.get('/statistics', async (req, res) => {
  await userController.getUserStatistics(req, res);
});

/**
 * Get specific user by ID.
 * Route: GET /api/users/:id
 * Access: Private (authenticated users with appropriate permissions).
 * @param {object} req - Express request object with params: {id: User ID}.
 * @param {object} res - Express response object.
 * @returns {Promise&lt;void>} Resolves when response is sent.
 * @example
   * // GET /api/endpoint
   * // Response: { "success": true, "data": [...] }
 * GET /api/users/abc123
 */
router.get('/:id', async (req, res) => {
  await userController.getUserById(req, res);
});

/**
 * Create new user.
 * Route: POST /api/users
 * Access: Private (superadmin, admin, client - based on role hierarchy).
 * @param {object} req - Express request object with body: {email, firstName, lastName, role, password?, clientId?, departmentId?, emailVerified?}.
 * @param {object} res - Express response object.
 * @returns {Promise&lt;void>} Resolves when response is sent.
 * @example
   * // GET /api/endpoint
   * // Response: { "success": true, "data": [...] }
 * POST /api/users with body: {email: 'user@example.com', firstName: 'John', lastName: 'Doe', role: 'employee'}
 */
router.post('/', writeOperationsLimiter, securityMiddleware.getCsrfProtection(), async (req, res) => {
  await userController.createUser(req, res);
});

/**
 * Update existing user.
 * Route: PUT /api/users/:id
 * Access: Private (authenticated users with appropriate permissions).
 * @param {object} req - Express request object with params: {id: User ID} and body: Partial user data to update.
 * @param {object} res - Express response object.
 * @returns {Promise&lt;void>} Resolves when response is sent.
 * @example
   * // POST /api/endpoint
   * // Body: { "data": "value" }
   * // Response: { "success": true, "message": "Created" }
 * PUT /api/users/abc123 with body: {firstName: 'Jane', active: false}
 */
router.put('/:id', writeOperationsLimiter, securityMiddleware.getCsrfProtection(), async (req, res) => {
  await userController.updateUser(req, res);
});

/**
 * Deactivate user (soft delete - follows AI agent rules).
 * Route: DELETE /api/users/:id
 * Access: Private (superadmin, admin, or users managing their subordinates).
 * @param {object} req - Express request object with params: {id: User ID} and body: {reason?: string}.
 * @param {object} res - Express response object.
 * @returns {Promise&lt;void>} Resolves when response is sent.
 * @example
   * // PUT /api/endpoint/123
   * // Body: { "field": "updated value" }
   * // Response: { "success": true, "data": {...} }
 * DELETE /api/users/abc123 with body: {reason: 'Policy violation'}
 */
router.delete('/:id', writeOperationsLimiter, securityMiddleware.getCsrfProtection(), async (req, res) => {
  await userController.deactivateUser(req, res);
});

/**
 * Reactivate deactivated user.
 * Route: PUT /api/users/:id/reactivate
 * Access: Private (superadmin, admin, or users managing their subordinates).
 * @param {object} req - Express request object with params: {id: User ID} and body: {reason?: string}.
 * @param {object} res - Express response object.
 * @returns {Promise&lt;void>} Resolves when response is sent.
 * @example
   * // PUT /api/endpoint/123
   * // Body: { "field": "updated value" }
   * // Response: { "success": true, "data": {...} }
 * PUT /api/users/abc123/reactivate with body: {reason: 'Appeal approved'}
 */
router.put('/:id/reactivate', writeOperationsLimiter, securityMiddleware.getCsrfProtection(), async (req, res) => {
  await userController.reactivateUser(req, res);
});

/**
 * Toggle user active status (activate/deactivate).
 * Route: PATCH /api/users/:id/toggle-status
 * Access: Private (superadmin, admin, or users managing their subordinates).
 * @param {object} req - Express request object with params: {id: User ID} and body: {active: boolean, reason?: string}.
 * @param {object} res - Express response object.
 * @returns {Promise&lt;void>} Resolves when response is sent.
 * @example
   * // PUT /api/endpoint/123
   * // Body: { "field": "updated value" }
   * // Response: { "success": true, "data": {...} }
 * PATCH /api/users/abc123/toggle-status with body: {active: false, reason: 'Suspension'}
 */
router.patch('/:id/toggle-status', writeOperationsLimiter, securityMiddleware.getCsrfProtection(), async (req, res) => {
  await userController.toggleUserStatus(req, res);
});

/**
 * Archive user (soft delete - sets active: false, exists: false).
 * Route: PATCH /api/users/:id/archive
 * Access: Private (superadmin only).
 * @param {object} req - Express request object with params: {id: User ID} and body: {reason?: string}.
 * @param {object} res - Express response object.
 * @returns {Promise&lt;void>} Resolves when response is sent.
 * @example
   * // PATCH /api/endpoint/123
   * // Body: { "field": "new value" }
   * // Response: { "success": true, "data": {...} }
 * PATCH /api/users/abc123/archive with body: {reason: 'Data retention policy'}
 */
router.patch('/:id/archive', writeOperationsLimiter, securityMiddleware.getCsrfProtection(), async (req, res) => {
  await userController.archiveUser(req, res);
});

/**
 * Error handling middleware for this router.
 */
router.use((error, req, res, _next) => {
  logger.error('User Management API Error:', {
    error: error.message,
    stack: error.stack,
    url: req.url,
    method: req.method,
    userId: req.user?.id,
    timestamp: new Date(),
  });

  // Don't expose internal errors to client
  res.status(error.status || 500).json({
    success: false,
    error: error.status === 500 ? 'Internal server error' : error.message,
    timestamp: new Date().toISOString(),
  });
});

module.exports = router;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="AdminController.html">AdminController</a></li><li><a href="AmexingAuthMiddleware.html">AmexingAuthMiddleware</a></li><li><a href="AmexingAuthService.html">AmexingAuthService</a></li><li><a href="AmexingUser.html">AmexingUser</a></li><li><a href="ApiController.html">ApiController</a></li><li><a href="AppleIdTokenValidator.html">AppleIdTokenValidator</a></li><li><a href="AppleOAuthService.html">AppleOAuthService</a></li><li><a href="AppleOAuthServiceCore.html">AppleOAuthServiceCore</a></li><li><a href="AppleSignInButton.html">AppleSignInButton</a></li><li><a href="AppleTokenExchanger.html">AppleTokenExchanger</a></li><li><a href="AuthController.html">AuthController</a></li><li><a href="AuthMiddleware.html">AuthMiddleware</a></li><li><a href="AuthenticationService.html">AuthenticationService</a></li><li><a href="AuthenticationServiceCore.html">AuthenticationServiceCore</a></li><li><a href="BaseController.html">BaseController</a></li><li><a href="Client.html">Client</a></li><li><a href="ClientController.html">ClientController</a></li><li><a href="CorporateOAuthInterface.html">CorporateOAuthInterface</a></li><li><a href="CorporateOAuthService.html">CorporateOAuthService</a></li><li><a href="CorporateSyncService.html">CorporateSyncService</a></li><li><a href="DashboardAuthMiddleware.html">DashboardAuthMiddleware</a></li><li><a href="DashboardController.html">DashboardController</a></li><li><a href="Department.html">Department</a></li><li><a href="DepartmentManagerController.html">DepartmentManagerController</a></li><li><a href="DepartmentOAuthFlowService.html">DepartmentOAuthFlowService</a></li><li><a href="DriverController.html">DriverController</a></li><li><a href="EmployeeController.html">EmployeeController</a></li><li><a href="GuestController.html">GuestController</a></li><li><a href="HomeController.html">HomeController</a></li><li><a href="IntelligentProviderSelector.html">IntelligentProviderSelector</a></li><li><a href="MobileOAuthOptimizer.html">MobileOAuthOptimizer</a></li><li><a href="NotificationsController.html">NotificationsController</a></li><li><a href="OAuthPermissionService.html">OAuthPermissionService</a></li><li><a href="OAuthProvider.html">OAuthProvider</a></li><li><a href="OAuthSecurityValidator.html">OAuthSecurityValidator</a></li><li><a href="OAuthService.html">OAuthService</a></li><li><a href="PermissionAuditService.html">PermissionAuditService</a></li><li><a href="PermissionContextService.html">PermissionContextService</a></li><li><a href="PermissionDelegationService.html">PermissionDelegationService</a></li><li><a href="PermissionInheritanceService.html">PermissionInheritanceService</a></li><li><a href="PermissionService.html">PermissionService</a></li><li><a href="RoleBasedController.html">RoleBasedController</a></li><li><a href="SecureSecretsManager.html">SecureSecretsManager</a></li><li><a href="SecurityMiddleware.html">SecurityMiddleware</a></li><li><a href="SuperAdminController.html">SuperAdminController</a></li><li><a href="UserManagementController.html">UserManagementController</a></li><li><a href="global.html#UserManagementService">UserManagementService</a></li><li><a href="ValidationMiddleware.html">ValidationMiddleware</a></li></ul><h3>Global</h3><ul><li><a href="global.html#BaseModel">BaseModel</a></li><li><a href="global.html#Parse">Parse</a></li><li><a href="global.html#about">about</a></li><li><a href="global.html#addCorporateDomain">addCorporateDomain</a></li><li><a href="global.html#authRateLimit">authRateLimit</a></li><li><a href="global.html#authenticateOptional">authenticateOptional</a></li><li><a href="global.html#authenticateToken">authenticateToken</a></li><li><a href="global.html#autoRefreshToken">autoRefreshToken</a></li><li><a href="global.html#checkUserPermission">checkUserPermission</a></li><li><a href="global.html#createEmergencyElevation">createEmergencyElevation</a></li><li><a href="global.html#createPermissionDelegation">createPermissionDelegation</a></li><li><a href="global.html#createPermissionOverride">createPermissionOverride</a></li><li><a href="global.html#crypto">crypto</a></li><li><a href="global.html#errorHandler">errorHandler</a></li><li><a href="global.html#express">express</a></li><li><a href="global.html#expressRateLimit">expressRateLimit</a></li><li><a href="global.html#extractUser">extractUser</a></li><li><a href="global.html#findUserById">findUserById</a></li><li><a href="global.html#generateCorporateOAuthURL">generateCorporateOAuthURL</a></li><li><a href="global.html#generateTokens">generateTokens</a></li><li><a href="global.html#getActiveDelegations">getActiveDelegations</a></li><li><a href="global.html#getAllSyncStatuses">getAllSyncStatuses</a></li><li><a href="global.html#getAppleOAuthAnalytics">getAppleOAuthAnalytics</a></li><li><a href="global.html#getAppleOAuthConfig">getAppleOAuthConfig</a></li><li><a href="global.html#getAppleUserData">getAppleUserData</a></li><li><a href="global.html#getAvailableContexts">getAvailableContexts</a></li><li><a href="global.html#getAvailableCorporateDomains">getAvailableCorporateDomains</a></li><li><a href="global.html#getAvailableDepartments">getAvailableDepartments</a></li><li><a href="global.html#getAvailablePermissions">getAvailablePermissions</a></li><li><a href="global.html#getCorporateClientDepartments">getCorporateClientDepartments</a></li><li><a href="global.html#getCorporateLandingConfig">getCorporateLandingConfig</a></li><li><a href="global.html#getCorporateSyncHistory">getCorporateSyncHistory</a></li><li><a href="global.html#getData">getData</a></li><li><a href="global.html#getDatabaseMetrics">getDatabaseMetrics</a></li><li><a href="global.html#getDelegatedPermissions">getDelegatedPermissions</a></li><li><a href="global.html#getDepartmentOAuthAnalytics">getDepartmentOAuthAnalytics</a></li><li><a href="global.html#getDepartmentOAuthConfig">getDepartmentOAuthConfig</a></li><li><a href="global.html#getDepartmentOAuthProviders">getDepartmentOAuthProviders</a></li><li><a href="global.html#getDepartmentPermissions">getDepartmentPermissions</a></li><li><a href="global.html#getErrorDetails">getErrorDetails</a></li><li><a href="global.html#getOAuthAuditLogs">getOAuthAuditLogs</a></li><li><a href="global.html#getOAuthProviderStatus">getOAuthProviderStatus</a></li><li><a href="global.html#getPermissionAuditReport">getPermissionAuditReport</a></li><li><a href="global.html#getPermissionAuditStats">getPermissionAuditStats</a></li><li><a href="global.html#getProviderDisplayName">getProviderDisplayName</a></li><li><a href="global.html#getRequestProperty">getRequestProperty</a></li><li><a href="global.html#getRolePermissions">getRolePermissions</a></li><li><a href="global.html#getSecretsManager">getSecretsManager</a></li><li><a href="global.html#getStatus">getStatus</a></li><li><a href="global.html#getSystemMetrics">getSystemMetrics</a></li><li><a href="global.html#getUserEffectivePermissions">getUserEffectivePermissions</a></li><li><a href="global.html#getUserPermissionInheritance">getUserPermissionInheritance</a></li><li><a href="global.html#getUserProfile">getUserProfile</a></li><li><a href="global.html#getVersion">getVersion</a></li><li><a href="global.html#gracefulShutdown">gracefulShutdown</a></li><li><a href="global.html#handleAppleOAuthCallback">handleAppleOAuthCallback</a></li><li><a href="global.html#handleAppleWebhook">handleAppleWebhook</a></li><li><a href="global.html#handleDepartmentOAuthCallback">handleDepartmentOAuthCallback</a></li><li><a href="global.html#handleMongoError">handleMongoError</a></li><li><a href="global.html#handleParseError">handleParseError</a></li><li><a href="global.html#handleValidationError">handleValidationError</a></li><li><a href="global.html#hasPermission">hasPermission</a></li><li><a href="global.html#https">https</a></li><li><a href="global.html#initialize">initialize</a></li><li><a href="global.html#initiateAppleOAuth">initiateAppleOAuth</a></li><li><a href="global.html#initiateDepartmentOAuth">initiateDepartmentOAuth</a></li><li><a href="global.html#jwt">jwt</a></li><li><a href="global.html#loadPrivateKey">loadPrivateKey</a></li><li><a href="global.html#logAccessAttempt">logAccessAttempt</a></li><li><a href="global.html#logDataAccess">logDataAccess</a></li><li><a href="global.html#logError">logError</a></li><li><a href="global.html#logSecurityEvent">logSecurityEvent</a></li><li><a href="global.html#logSystemChange">logSystemChange</a></li><li><a href="global.html#logger">logger</a></li><li><a href="global.html#login">login</a></li><li><a href="global.html#logout">logout</a></li><li><a href="global.html#optionalAuth">optionalAuth</a></li><li><a href="global.html#recordSuccessfulLogin">recordSuccessfulLogin</a></li><li><a href="global.html#register">register</a></li><li><a href="global.html#registerCloudFunctions">registerCloudFunctions</a></li><li><a href="global.html#requireRole">requireRole</a></li><li><a href="global.html#revokeAppleOAuth">revokeAppleOAuth</a></li><li><a href="global.html#revokePermissionDelegation">revokePermissionDelegation</a></li><li><a href="global.html#setRequestProperty">setRequestProperty</a></li><li><a href="global.html#showForgotPassword">showForgotPassword</a></li><li><a href="global.html#showLogin">showLogin</a></li><li><a href="global.html#showRegister">showRegister</a></li><li><a href="global.html#showResetPassword">showResetPassword</a></li><li><a href="global.html#startPeriodicSync">startPeriodicSync</a></li><li><a href="global.html#stopPeriodicSync">stopPeriodicSync</a></li><li><a href="global.html#switchPermissionContext">switchPermissionContext</a></li><li><a href="global.html#switchToDepartmentContext">switchToDepartmentContext</a></li><li><a href="global.html#testCorporateDomain">testCorporateDomain</a></li><li><a href="global.html#triggerCorporateSync">triggerCorporateSync</a></li><li><a href="global.html#updateUserProfile">updateUserProfile</a></li><li><a href="global.html#validateAppleDomain">validateAppleDomain</a></li><li><a href="global.html#validateCorporateLandingAccess">validateCorporateLandingAccess</a></li><li><a href="global.html#validateDepartmentOAuthAccess">validateDepartmentOAuthAccess</a></li><li><a href="global.html#validateLogin">validateLogin</a></li><li><a href="global.html#validateNewPassword">validateNewPassword</a></li><li><a href="global.html#validatePassword">validatePassword</a></li><li><a href="global.html#validatePasswordReset">validatePasswordReset</a></li><li><a href="global.html#validateRegistration">validateRegistration</a></li><li><a href="global.html#validateRequest">validateRequest</a></li><li><a href="global.html#validateUpdateProfile">validateUpdateProfile</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Wed Sep 24 2025 12:14:54 GMT-0600 (hora est√°ndar central)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
