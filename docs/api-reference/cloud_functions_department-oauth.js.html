<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: cloud/functions/department-oauth.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: cloud/functions/department-oauth.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Department OAuth Cloud Functions - Sprint 04
 * Handle department-specific OAuth flows and integration
 * Integrates with Sprint 03 permission system.
 */

const Parse = require('parse/node');
const { DepartmentOAuthFlowService } = require('../../application/services/DepartmentOAuthFlowService');
const { PermissionAuditService } = require('../../application/services/PermissionAuditService');
const logger = require('../../infrastructure/logger');

// Initialize services
const departmentOAuthService = new DepartmentOAuthFlowService();
const auditService = new PermissionAuditService();

/**
 * Get available departments for OAuth.
 * @param {object} request - Parse Cloud Code request object.
 * @param {object} request.user - Current authenticated user.
 * @returns {Promise&lt;object>} Available departments for user.
 */
const getAvailableDepartments = async (request) => {
  const { user } = request;

  try {
    // Get available departments
    const departments = departmentOAuthService.getAvailableDepartments();

    // Filter based on user context if authenticated
    let filteredDepartments = departments;
    if (user) {
      // User might have restricted department access
      const userDepartments = user.get('departments') || [user.get('department')].filter(Boolean);
      filteredDepartments = departments.filter(
        (dept) => !userDepartments.length || userDepartments.includes(dept.code)
      );
    }

    // Log audit event
    await auditService.recordPermissionAudit({
      userId: user?.id || 'anonymous',
      action: 'departments_list_requested',
      resource: 'department_oauth',
      performedBy: user?.id || 'anonymous',
      metadata: {
        availableDepartments: filteredDepartments.length,
        userDepartments: user?.get('departments'),
        timestamp: new Date(),
      },
    });

    return {
      success: true,
      departments: filteredDepartments,
    };
  } catch (error) {
    logger.error('Get available departments failed:', error);
    throw new Parse.Error(Parse.Error.INTERNAL_SERVER_ERROR, 'Failed to get departments');
  }
};

/**
 * Initiate department-specific OAuth flow.
 * @param request
 */
const initiateDepartmentOAuth = async (request) => {
  const { params, ip } = request;
  const {
    department, provider, corporateConfigId, redirectUri,
  } = params;

  try {
    // Validate required parameters
    if (!department || !provider) {
      throw new Parse.Error(Parse.Error.INVALID_QUERY, 'Department and provider are required');
    }

    // Generate state for OAuth flow
    const state = require('crypto').randomBytes(32).toString('hex');

    // Initiate OAuth flow
    const result = await departmentOAuthService.initiateDepartmentOAuth({
      department,
      provider,
      corporateConfigId,
      redirectUri: redirectUri || `${process.env.PARSE_PUBLIC_SERVER_URL}/auth/oauth/callback`,
      state,
      headers: request.headers,
      ip,
    });

    // Store OAuth state for validation
    const OAuthState = Parse.Object.extend('OAuthState');
    const stateRecord = new OAuthState();
    stateRecord.set('state', state);
    stateRecord.set('department', department);
    stateRecord.set('provider', provider);
    stateRecord.set('corporateConfigId', corporateConfigId);
    stateRecord.set('expiresAt', new Date(Date.now() + 10 * 60 * 1000)); // 10 minutes
    stateRecord.set('ipAddress', ip);
    stateRecord.set('userAgent', request.headers['user-agent']);
    await stateRecord.save(null, { useMasterKey: true });

    logger.info(`Department OAuth initiated: ${department}/${provider} from IP: ${ip}`);

    return {
      success: true,
      authUrl: result.authUrl,
      state,
      expiresIn: result.expiresIn,
    };
  } catch (error) {
    logger.error('Initiate department OAuth failed:', error);
    throw error;
  }
};

/**
 * Handle department OAuth callback.
 * @param request
 */
const handleDepartmentOAuthCallback = async (request) => {
  const { params, ip } = request;
  const {
    code, state, error: oauthError,
  } = params;

  try {
    // Parse state to get department and provider info
    let stateData;
    try {
      stateData = JSON.parse(state);
    } catch {
      // Fallback for simple state values
      stateData = { originalState: state };
    }

    const { provider, department, originalState } = stateData;

    // Validate OAuth state
    const OAuthState = Parse.Object.extend('OAuthState');
    const stateQuery = new Parse.Query(OAuthState);
    stateQuery.equalTo('state', originalState || state);
    stateQuery.greaterThan('expiresAt', new Date());

    const stateRecord = await stateQuery.first({ useMasterKey: true });
    if (!stateRecord) {
      throw new Parse.Error(Parse.Error.INVALID_QUERY, 'Invalid or expired OAuth state');
    }

    // Use provider from state record if not in parsed data
    const finalProvider = provider || stateRecord.get('provider');
    const finalDepartment = department || stateRecord.get('department');

    // Handle OAuth callback
    const result = await departmentOAuthService.handleDepartmentOAuthCallback({
      code,
      state: originalState || state,
      provider: finalProvider,
      department: finalDepartment,
      error: oauthError,
      corporateConfigId: stateRecord.get('corporateConfigId'),
      ip,
    });

    // Clean up state record
    await stateRecord.destroy({ useMasterKey: true });

    logger.info(`Department OAuth callback successful: ${finalDepartment}/${finalProvider} for user: ${result.user.id}`);

    return result;
  } catch (error) {
    logger.error('Department OAuth callback failed:', error);
    throw error;
  }
};

/**
 * Get department OAuth configuration.
 * @param request
 */
const getDepartmentOAuthConfig = async (request) => {
  const { params, user } = request;
  const { department } = params;

  try {
    if (!department) {
      throw new Parse.Error(Parse.Error.INVALID_QUERY, 'Department is required');
    }

    // Get department configuration
    const deptConfig = departmentOAuthService.getDepartmentConfig(department);
    if (!deptConfig) {
      throw new Parse.Error(Parse.Error.OBJECT_NOT_FOUND, `Department not found: ${department}`);
    }

    // Check if user has access to this department info
    if (user) {
      const userDepartments = user.get('departments') || [user.get('department')].filter(Boolean);
      if (userDepartments.length > 0 &amp;&amp; !userDepartments.includes(department)) {
        throw new Parse.Error(Parse.Error.OPERATION_FORBIDDEN, 'Access denied to department configuration');
      }
    }

    // Return public configuration (without sensitive data)
    const publicConfig = {
      code: deptConfig.code,
      name: deptConfig.name,
      allowedProviders: deptConfig.allowedProviders,
      approvalRequired: deptConfig.approvalRequired,
      metadata: deptConfig.metadata,
    };

    // Log audit event
    await auditService.recordPermissionAudit({
      userId: user?.id || 'anonymous',
      action: 'department_config_requested',
      resource: 'department_oauth_config',
      performedBy: user?.id || 'anonymous',
      metadata: {
        department,
        timestamp: new Date(),
      },
    });

    return {
      success: true,
      config: publicConfig,
    };
  } catch (error) {
    logger.error('Get department OAuth config failed:', error);
    throw error;
  }
};

/**
 * Switch user to department context post-OAuth.
 * @param request
 */
const switchToDepartmentContext = async (request) => {
  const { params, user } = request;
  const { department, sessionId } = params;

  if (!user) {
    throw new Parse.Error(Parse.Error.INVALID_SESSION_TOKEN, 'Authentication required');
  }

  try {
    if (!department) {
      throw new Parse.Error(Parse.Error.INVALID_QUERY, 'Department is required');
    }

    // Verify user has access to this department
    const userDepartments = user.get('departments') || [user.get('department')].filter(Boolean);
    if (!userDepartments.includes(department)) {
      throw new Parse.Error(Parse.Error.OPERATION_FORBIDDEN, 'Access denied to department');
    }

    // Switch to department context using Sprint 03 system
    const { PermissionContextService } = require('../../application/services/PermissionContextService');
    const contextService = new PermissionContextService();

    const contextId = `dept-${department}`;
    const result = await contextService.switchToContext(user.id, contextId, sessionId);

    // Log context switch
    await auditService.recordPermissionAudit({
      userId: user.id,
      sessionId,
      action: 'department_context_switch',
      resource: 'permission_context',
      performedBy: user.id,
      metadata: {
        department,
        contextId,
        previousContext: result.previousContext?.id,
        timestamp: new Date(),
      },
    });

    return {
      success: true,
      contextId,
      permissions: result.appliedPermissions,
      department,
    };
  } catch (error) {
    logger.error('Switch to department context failed:', error);
    throw error;
  }
};

/**
 * Get department OAuth providers with dynamic configuration.
 * @param request
 */
const getDepartmentOAuthProviders = async (request) => {
  const { params } = request;
  const { department } = params;

  try {
    if (!department) {
      throw new Parse.Error(Parse.Error.INVALID_QUERY, 'Department is required');
    }

    // Get department configuration
    const deptConfig = departmentOAuthService.getDepartmentConfig(department);
    if (!deptConfig) {
      throw new Parse.Error(Parse.Error.OBJECT_NOT_FOUND, `Department not found: ${department}`);
    }

    // Get provider configurations
    const providers = await Promise.all(
      deptConfig.allowedProviders.map(async (providerName) => {
        const scopes = departmentOAuthService.getDepartmentScopes(department, providerName);

        return {
          name: providerName,
          displayName: this.getProviderDisplayName(providerName),
          scopes,
          departmentSpecific: true,
          available: true,
        };
      })
    );

    return {
      success: true,
      department: {
        code: deptConfig.code,
        name: deptConfig.name,
      },
      providers,
    };
  } catch (error) {
    logger.error('Get department OAuth providers failed:', error);
    throw error;
  }
};

/**
 * Validate department OAuth access.
 * @param request
 */
const validateDepartmentOAuthAccess = async (request) => {
  const { params, user, ip } = request;
  const { department, provider, email } = params;

  try {
    if (!department || !provider) {
      throw new Parse.Error(Parse.Error.INVALID_QUERY, 'Department and provider are required');
    }

    // Get department configuration
    const deptConfig = departmentOAuthService.getDepartmentConfig(department);
    if (!deptConfig) {
      throw new Parse.Error(Parse.Error.OBJECT_NOT_FOUND, `Department not found: ${department}`);
    }

    // Validate provider is allowed for department
    if (!deptConfig.allowedProviders.includes(provider)) {
      throw new Parse.Error(
        Parse.Error.OPERATION_FORBIDDEN,
        `Provider ${provider} not allowed for department ${department}`
      );
    }

    // Email domain validation if provided
    let emailValidation = { valid: true, reason: null };
    if (email &amp;&amp; deptConfig.emailDomain) {
      const emailDomain = email.split('@')[1];
      if (emailDomain !== deptConfig.emailDomain) {
        emailValidation = {
          valid: false,
          reason: `Email domain ${emailDomain} not allowed for department ${department}`,
        };
      }
    }

    // Check approval requirements
    const approvalInfo = {
      required: deptConfig.approvalRequired,
      workflow: deptConfig.approvalWorkflow,
      estimatedTime: deptConfig.approvalRequired ? '1-2 business days' : null,
    };

    // Log validation attempt
    await auditService.recordPermissionAudit({
      userId: user?.id || 'anonymous',
      action: 'department_oauth_validation',
      resource: 'department_oauth_access',
      performedBy: user?.id || 'anonymous',
      metadata: {
        department,
        provider,
        email: email ? `${email.substring(0, 3)}***` : null,
        valid: emailValidation.valid,
        approvalRequired: deptConfig.approvalRequired,
        ip,
        timestamp: new Date(),
      },
    });

    return {
      success: true,
      valid: emailValidation.valid,
      reason: emailValidation.reason,
      department: {
        code: deptConfig.code,
        name: deptConfig.name,
      },
      provider: {
        name: provider,
        allowed: true,
      },
      approval: approvalInfo,
    };
  } catch (error) {
    logger.error('Validate department OAuth access failed:', error);
    throw error;
  }
};

/**
 * Get department OAuth analytics (for admins).
 * @param request
 */
const getDepartmentOAuthAnalytics = async (request) => {
  const { params, user } = request;
  const { department, timeRange = '30d' } = params;

  if (!user) {
    throw new Parse.Error(Parse.Error.INVALID_SESSION_TOKEN, 'Authentication required');
  }

  try {
    // Check if user has analytics access
    const userRole = user.get('role');
    if (!['admin', 'superadmin', 'manager'].includes(userRole)) {
      throw new Parse.Error(Parse.Error.OPERATION_FORBIDDEN, 'Analytics access denied');
    }

    // If department specified, check access
    if (department) {
      const userDepartments = user.get('departments') || [user.get('department')].filter(Boolean);
      if (userRole !== 'superadmin' &amp;&amp; !userDepartments.includes(department)) {
        throw new Parse.Error(Parse.Error.OPERATION_FORBIDDEN, 'Department access denied');
      }
    }

    // Calculate date range
    const endDate = new Date();
    const startDate = new Date();
    switch (timeRange) {
      case '7d':
        startDate.setDate(endDate.getDate() - 7);
        break;
      case '30d':
        startDate.setDate(endDate.getDate() - 30);
        break;
      case '90d':
        startDate.setDate(endDate.getDate() - 90);
        break;
      default:
        startDate.setDate(endDate.getDate() - 30);
    }

    // Query audit logs for department OAuth activity
    const auditQuery = new Parse.Query('PermissionAudit');
    auditQuery.greaterThanOrEqualTo('timestamp', startDate);
    auditQuery.lessThanOrEqualTo('timestamp', endDate);
    auditQuery.containsAll('action', ['department_oauth']);

    if (department) {
      auditQuery.equalTo('metadata.department', department);
    }

    auditQuery.limit(1000);
    const auditEntries = await auditQuery.find({ useMasterKey: true });

    // Process analytics data
    const analytics = {
      totalLogins: 0,
      successfulLogins: 0,
      failedLogins: 0,
      providerBreakdown: {},
      departmentBreakdown: {},
      dailyActivity: {},
      topUsers: {},
      errors: [],
    };

    auditEntries.forEach((entry) => {
      const metadata = entry.get('metadata') || {};
      const action = entry.get('action');
      const timestamp = entry.get('timestamp');
      const date = timestamp.toISOString().split('T')[0];

      // Count by action type
      if (action.includes('oauth_success')) {
        analytics.successfulLogins++;
      } else if (action.includes('oauth_failed')) {
        analytics.failedLogins++;
      }
      analytics.totalLogins++;

      // Provider breakdown
      if (metadata.provider) {
        analytics.providerBreakdown[metadata.provider] = (analytics.providerBreakdown[metadata.provider] || 0) + 1;
      }

      // Department breakdown
      if (metadata.department) {
        analytics.departmentBreakdown[metadata.department] = (
          analytics.departmentBreakdown[metadata.department] || 0
        ) + 1;
      }

      // Daily activity
      analytics.dailyActivity[date] = (analytics.dailyActivity[date] || 0) + 1;

      // Top users
      const userId = entry.get('userId');
      if (userId &amp;&amp; userId !== 'anonymous') {
        analytics.topUsers[userId] = (analytics.topUsers[userId] || 0) + 1;
      }

      // Collect errors
      if (metadata.error) {
        analytics.errors.push({
          timestamp,
          error: metadata.error,
          department: metadata.department,
          provider: metadata.provider,
        });
      }
    });

    // Convert top users to sorted array
    analytics.topUsers = Object.entries(analytics.topUsers)
      .sort(([, a], [, b]) => b - a)
      .slice(0, 10)
      .map(([userId, count]) => ({ userId, count }));

    // Log analytics access
    await auditService.recordPermissionAudit({
      userId: user.id,
      action: 'department_oauth_analytics_accessed',
      resource: 'analytics',
      performedBy: user.id,
      metadata: {
        department,
        timeRange,
        recordsAnalyzed: auditEntries.length,
        timestamp: new Date(),
      },
    });

    return {
      success: true,
      timeRange: {
        start: startDate,
        end: endDate,
        range: timeRange,
      },
      analytics,
    };
  } catch (error) {
    logger.error('Get department OAuth analytics failed:', error);
    throw error;
  }
};

/**
 * Helper function to get provider display names.
 * @param provider
 * @example
   * // const result = await authService.login(credentials);
   * // Returns: { success: true, user: {...}, tokens: {...} }
 */
function getProviderDisplayName(provider) {
  const displayNames = {
    google: 'Google Workspace',
    microsoft: 'Microsoft 365',
    apple: 'Apple ID',
    github: 'GitHub',
  };

  return displayNames[provider] || provider;
}

module.exports = {
  getAvailableDepartments,
  initiateDepartmentOAuth,
  handleDepartmentOAuthCallback,
  getDepartmentOAuthConfig,
  switchToDepartmentContext,
  getDepartmentOAuthProviders,
  validateDepartmentOAuthAccess,
  getDepartmentOAuthAnalytics,
  // Export helper functions for testing
  getProviderDisplayName,
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="AdminController.html">AdminController</a></li><li><a href="AmexingAuthMiddleware.html">AmexingAuthMiddleware</a></li><li><a href="AmexingAuthService.html">AmexingAuthService</a></li><li><a href="AmexingUser.html">AmexingUser</a></li><li><a href="ApiController.html">ApiController</a></li><li><a href="AppleIdTokenValidator.html">AppleIdTokenValidator</a></li><li><a href="AppleOAuthService.html">AppleOAuthService</a></li><li><a href="AppleOAuthServiceCore.html">AppleOAuthServiceCore</a></li><li><a href="AppleSignInButton.html">AppleSignInButton</a></li><li><a href="AppleTokenExchanger.html">AppleTokenExchanger</a></li><li><a href="AuthController.html">AuthController</a></li><li><a href="AuthMiddleware.html">AuthMiddleware</a></li><li><a href="AuthenticationService.html">AuthenticationService</a></li><li><a href="AuthenticationServiceCore.html">AuthenticationServiceCore</a></li><li><a href="BaseController.html">BaseController</a></li><li><a href="Client.html">Client</a></li><li><a href="ClientController.html">ClientController</a></li><li><a href="CorporateOAuthInterface.html">CorporateOAuthInterface</a></li><li><a href="CorporateOAuthService.html">CorporateOAuthService</a></li><li><a href="CorporateSyncService.html">CorporateSyncService</a></li><li><a href="DashboardAuthMiddleware.html">DashboardAuthMiddleware</a></li><li><a href="DashboardController.html">DashboardController</a></li><li><a href="Department.html">Department</a></li><li><a href="DepartmentManagerController.html">DepartmentManagerController</a></li><li><a href="DepartmentOAuthFlowService.html">DepartmentOAuthFlowService</a></li><li><a href="DriverController.html">DriverController</a></li><li><a href="EmployeeController.html">EmployeeController</a></li><li><a href="GuestController.html">GuestController</a></li><li><a href="HomeController.html">HomeController</a></li><li><a href="IntelligentProviderSelector.html">IntelligentProviderSelector</a></li><li><a href="MobileOAuthOptimizer.html">MobileOAuthOptimizer</a></li><li><a href="NotificationsController.html">NotificationsController</a></li><li><a href="OAuthPermissionService.html">OAuthPermissionService</a></li><li><a href="OAuthProvider.html">OAuthProvider</a></li><li><a href="OAuthSecurityValidator.html">OAuthSecurityValidator</a></li><li><a href="OAuthService.html">OAuthService</a></li><li><a href="PermissionAuditService.html">PermissionAuditService</a></li><li><a href="PermissionContextService.html">PermissionContextService</a></li><li><a href="PermissionDelegationService.html">PermissionDelegationService</a></li><li><a href="PermissionInheritanceService.html">PermissionInheritanceService</a></li><li><a href="PermissionService.html">PermissionService</a></li><li><a href="RoleBasedController.html">RoleBasedController</a></li><li><a href="SecureSecretsManager.html">SecureSecretsManager</a></li><li><a href="SecurityMiddleware.html">SecurityMiddleware</a></li><li><a href="SuperAdminController.html">SuperAdminController</a></li><li><a href="UserManagementController.html">UserManagementController</a></li><li><a href="global.html#UserManagementService">UserManagementService</a></li><li><a href="ValidationMiddleware.html">ValidationMiddleware</a></li></ul><h3>Global</h3><ul><li><a href="global.html#BaseModel">BaseModel</a></li><li><a href="global.html#Parse">Parse</a></li><li><a href="global.html#about">about</a></li><li><a href="global.html#addCorporateDomain">addCorporateDomain</a></li><li><a href="global.html#authRateLimit">authRateLimit</a></li><li><a href="global.html#authenticateOptional">authenticateOptional</a></li><li><a href="global.html#authenticateToken">authenticateToken</a></li><li><a href="global.html#autoRefreshToken">autoRefreshToken</a></li><li><a href="global.html#checkUserPermission">checkUserPermission</a></li><li><a href="global.html#createEmergencyElevation">createEmergencyElevation</a></li><li><a href="global.html#createPermissionDelegation">createPermissionDelegation</a></li><li><a href="global.html#createPermissionOverride">createPermissionOverride</a></li><li><a href="global.html#crypto">crypto</a></li><li><a href="global.html#errorHandler">errorHandler</a></li><li><a href="global.html#express">express</a></li><li><a href="global.html#expressRateLimit">expressRateLimit</a></li><li><a href="global.html#extractUser">extractUser</a></li><li><a href="global.html#findUserById">findUserById</a></li><li><a href="global.html#generateCorporateOAuthURL">generateCorporateOAuthURL</a></li><li><a href="global.html#generateTokens">generateTokens</a></li><li><a href="global.html#getActiveDelegations">getActiveDelegations</a></li><li><a href="global.html#getAllSyncStatuses">getAllSyncStatuses</a></li><li><a href="global.html#getAppleOAuthAnalytics">getAppleOAuthAnalytics</a></li><li><a href="global.html#getAppleOAuthConfig">getAppleOAuthConfig</a></li><li><a href="global.html#getAppleUserData">getAppleUserData</a></li><li><a href="global.html#getAvailableContexts">getAvailableContexts</a></li><li><a href="global.html#getAvailableCorporateDomains">getAvailableCorporateDomains</a></li><li><a href="global.html#getAvailableDepartments">getAvailableDepartments</a></li><li><a href="global.html#getAvailablePermissions">getAvailablePermissions</a></li><li><a href="global.html#getCorporateClientDepartments">getCorporateClientDepartments</a></li><li><a href="global.html#getCorporateLandingConfig">getCorporateLandingConfig</a></li><li><a href="global.html#getCorporateSyncHistory">getCorporateSyncHistory</a></li><li><a href="global.html#getData">getData</a></li><li><a href="global.html#getDatabaseMetrics">getDatabaseMetrics</a></li><li><a href="global.html#getDelegatedPermissions">getDelegatedPermissions</a></li><li><a href="global.html#getDepartmentOAuthAnalytics">getDepartmentOAuthAnalytics</a></li><li><a href="global.html#getDepartmentOAuthConfig">getDepartmentOAuthConfig</a></li><li><a href="global.html#getDepartmentOAuthProviders">getDepartmentOAuthProviders</a></li><li><a href="global.html#getDepartmentPermissions">getDepartmentPermissions</a></li><li><a href="global.html#getErrorDetails">getErrorDetails</a></li><li><a href="global.html#getOAuthAuditLogs">getOAuthAuditLogs</a></li><li><a href="global.html#getOAuthProviderStatus">getOAuthProviderStatus</a></li><li><a href="global.html#getPermissionAuditReport">getPermissionAuditReport</a></li><li><a href="global.html#getPermissionAuditStats">getPermissionAuditStats</a></li><li><a href="global.html#getProviderDisplayName">getProviderDisplayName</a></li><li><a href="global.html#getRequestProperty">getRequestProperty</a></li><li><a href="global.html#getRolePermissions">getRolePermissions</a></li><li><a href="global.html#getSecretsManager">getSecretsManager</a></li><li><a href="global.html#getStatus">getStatus</a></li><li><a href="global.html#getSystemMetrics">getSystemMetrics</a></li><li><a href="global.html#getUserEffectivePermissions">getUserEffectivePermissions</a></li><li><a href="global.html#getUserPermissionInheritance">getUserPermissionInheritance</a></li><li><a href="global.html#getUserProfile">getUserProfile</a></li><li><a href="global.html#getVersion">getVersion</a></li><li><a href="global.html#gracefulShutdown">gracefulShutdown</a></li><li><a href="global.html#handleAppleOAuthCallback">handleAppleOAuthCallback</a></li><li><a href="global.html#handleAppleWebhook">handleAppleWebhook</a></li><li><a href="global.html#handleDepartmentOAuthCallback">handleDepartmentOAuthCallback</a></li><li><a href="global.html#handleMongoError">handleMongoError</a></li><li><a href="global.html#handleParseError">handleParseError</a></li><li><a href="global.html#handleValidationError">handleValidationError</a></li><li><a href="global.html#hasPermission">hasPermission</a></li><li><a href="global.html#https">https</a></li><li><a href="global.html#initialize">initialize</a></li><li><a href="global.html#initiateAppleOAuth">initiateAppleOAuth</a></li><li><a href="global.html#initiateDepartmentOAuth">initiateDepartmentOAuth</a></li><li><a href="global.html#jwt">jwt</a></li><li><a href="global.html#loadPrivateKey">loadPrivateKey</a></li><li><a href="global.html#logAccessAttempt">logAccessAttempt</a></li><li><a href="global.html#logDataAccess">logDataAccess</a></li><li><a href="global.html#logError">logError</a></li><li><a href="global.html#logSecurityEvent">logSecurityEvent</a></li><li><a href="global.html#logSystemChange">logSystemChange</a></li><li><a href="global.html#logger">logger</a></li><li><a href="global.html#login">login</a></li><li><a href="global.html#logout">logout</a></li><li><a href="global.html#optionalAuth">optionalAuth</a></li><li><a href="global.html#recordSuccessfulLogin">recordSuccessfulLogin</a></li><li><a href="global.html#register">register</a></li><li><a href="global.html#registerCloudFunctions">registerCloudFunctions</a></li><li><a href="global.html#requireRole">requireRole</a></li><li><a href="global.html#revokeAppleOAuth">revokeAppleOAuth</a></li><li><a href="global.html#revokePermissionDelegation">revokePermissionDelegation</a></li><li><a href="global.html#setRequestProperty">setRequestProperty</a></li><li><a href="global.html#showForgotPassword">showForgotPassword</a></li><li><a href="global.html#showLogin">showLogin</a></li><li><a href="global.html#showRegister">showRegister</a></li><li><a href="global.html#showResetPassword">showResetPassword</a></li><li><a href="global.html#startPeriodicSync">startPeriodicSync</a></li><li><a href="global.html#stopPeriodicSync">stopPeriodicSync</a></li><li><a href="global.html#switchPermissionContext">switchPermissionContext</a></li><li><a href="global.html#switchToDepartmentContext">switchToDepartmentContext</a></li><li><a href="global.html#testCorporateDomain">testCorporateDomain</a></li><li><a href="global.html#triggerCorporateSync">triggerCorporateSync</a></li><li><a href="global.html#updateUserProfile">updateUserProfile</a></li><li><a href="global.html#validateAppleDomain">validateAppleDomain</a></li><li><a href="global.html#validateCorporateLandingAccess">validateCorporateLandingAccess</a></li><li><a href="global.html#validateDepartmentOAuthAccess">validateDepartmentOAuthAccess</a></li><li><a href="global.html#validateLogin">validateLogin</a></li><li><a href="global.html#validateNewPassword">validateNewPassword</a></li><li><a href="global.html#validatePassword">validatePassword</a></li><li><a href="global.html#validatePasswordReset">validatePasswordReset</a></li><li><a href="global.html#validateRegistration">validateRegistration</a></li><li><a href="global.html#validateRequest">validateRequest</a></li><li><a href="global.html#validateUpdateProfile">validateUpdateProfile</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Wed Sep 24 2025 12:14:54 GMT-0600 (hora est√°ndar central)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
