<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: cloud/main.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: cloud/main.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/* eslint-disable no-unused-vars */
const Parse = require('parse/node');
const logger = require('../infrastructure/logger');

// Import models and services
const AmexingUser = require('../domain/models/AmexingUser');
const AuthenticationService = require('../application/services/AuthenticationService');
const OAuthService = require('../application/services/OAuthService');

// Import cloud functions
const helloWorldFunction = require('./functions/helloWorld');
const testFunction = require('./functions/test');
const oauthAdminFunctions = require('./functions/oauth-admin');
const corporateLandingFunctions = require('./functions/corporate-landing');
const corporateSyncFunctions = require('./functions/corporate-sync');
const oauthPermissionsFunctions = require('./functions/oauth-permissions');
const departmentOAuthFunctions = require('./functions/department-oauth');
const appleOAuthFunctions = require('./functions/apple-oauth');

/**
 * Registers all Parse Cloud Functions for the Amexing platform.
 * Centralizes the registration of OAuth authentication, corporate synchronization,
 * department management, and administrative functions with comprehensive error handling
 * and security logging for Parse Server integration.
 *
 * This function orchestrates the registration of all cloud functions including OAuth
 * admin operations, corporate landing configuration, sync management, permission
 * handling, department OAuth flows, and Apple authentication integration.
 * @function registerCloudFunctions
 * @author Amexing Development Team
 * @version 2.0.0
 * @since 1.0.0
 * @example
   * // const result = await authService.login(credentials);
   * // Returns: { success: true, user: {...}, tokens: {...} }
 * // Register all cloud functions during Parse Server initialization
 * registerCloudFunctions();
 *
 * // Cloud functions become available via Parse SDK
 * const result = await Parse.Cloud.run('getAvailableCorporateDomains');
 * const oauthUrl = await Parse.Cloud.run('generateCorporateOAuthURL', { domain: 'example.com' });
 * const syncStatus = await Parse.Cloud.run('triggerCorporateSync', { domain: 'company.com' });
 */
function registerCloudFunctions() {
  try {
    // Register Cloud Functions
    Parse.Cloud.define('hello', helloWorldFunction);
    Parse.Cloud.define('test', testFunction);

    // Register OAuth Admin Functions
    Parse.Cloud.define('getAvailableCorporateDomains', oauthAdminFunctions.getAvailableCorporateDomains);
    Parse.Cloud.define('addCorporateDomain', oauthAdminFunctions.addCorporateDomain);
    Parse.Cloud.define('getOAuthProviderStatus', oauthAdminFunctions.getOAuthProviderStatus);
    Parse.Cloud.define('testCorporateDomain', oauthAdminFunctions.testCorporateDomain);
    Parse.Cloud.define('getOAuthAuditLogs', oauthAdminFunctions.getOAuthAuditLogs);

    // Register Corporate Landing Functions
    Parse.Cloud.define('getCorporateLandingConfig', corporateLandingFunctions.getCorporateLandingConfig);
    Parse.Cloud.define('generateCorporateOAuthURL', corporateLandingFunctions.generateCorporateOAuthURL);
    Parse.Cloud.define('validateCorporateLandingAccess', corporateLandingFunctions.validateCorporateLandingAccess);
    Parse.Cloud.define('getCorporateClientDepartments', corporateLandingFunctions.getCorporateClientDepartments);

    // Register Corporate Sync Functions
    Parse.Cloud.define('triggerCorporateSync', corporateSyncFunctions.triggerCorporateSync);
    Parse.Cloud.define('startPeriodicSync', corporateSyncFunctions.startPeriodicSync);
    Parse.Cloud.define('stopPeriodicSync', corporateSyncFunctions.stopPeriodicSync);
    Parse.Cloud.define('getAllSyncStatuses', corporateSyncFunctions.getAllSyncStatuses);
    Parse.Cloud.define('getCorporateSyncHistory', corporateSyncFunctions.getCorporateSyncHistory);

    // Register OAuth Permissions Functions
    Parse.Cloud.define('getUserPermissionInheritance', oauthPermissionsFunctions.getUserPermissionInheritance);
    Parse.Cloud.define('getAvailableContexts', oauthPermissionsFunctions.getAvailableContexts);
    Parse.Cloud.define('switchPermissionContext', oauthPermissionsFunctions.switchPermissionContext);
    Parse.Cloud.define('createPermissionDelegation', oauthPermissionsFunctions.createPermissionDelegation);
    Parse.Cloud.define('revokePermissionDelegation', oauthPermissionsFunctions.revokePermissionDelegation);
    Parse.Cloud.define('createEmergencyElevation', oauthPermissionsFunctions.createEmergencyElevation);
    Parse.Cloud.define('createPermissionOverride', oauthPermissionsFunctions.createPermissionOverride);
    Parse.Cloud.define('checkUserPermission', oauthPermissionsFunctions.checkUserPermission);
    Parse.Cloud.define('getActiveDelegations', oauthPermissionsFunctions.getActiveDelegations);
    Parse.Cloud.define('getDelegatedPermissions', oauthPermissionsFunctions.getDelegatedPermissions);
    Parse.Cloud.define('getPermissionAuditReport', oauthPermissionsFunctions.getPermissionAuditReport);
    Parse.Cloud.define('getPermissionAuditStats', oauthPermissionsFunctions.getPermissionAuditStats);
    Parse.Cloud.define('getAvailablePermissions', oauthPermissionsFunctions.getAvailablePermissions);

    // Register Department OAuth Functions
    Parse.Cloud.define('getAvailableDepartments', departmentOAuthFunctions.getAvailableDepartments);
    Parse.Cloud.define('initiateDepartmentOAuth', departmentOAuthFunctions.initiateDepartmentOAuth);
    Parse.Cloud.define('handleDepartmentOAuthCallback', departmentOAuthFunctions.handleDepartmentOAuthCallback);
    Parse.Cloud.define('getDepartmentOAuthConfig', departmentOAuthFunctions.getDepartmentOAuthConfig);
    Parse.Cloud.define('switchToDepartmentContext', departmentOAuthFunctions.switchToDepartmentContext);
    Parse.Cloud.define('getDepartmentOAuthProviders', departmentOAuthFunctions.getDepartmentOAuthProviders);
    Parse.Cloud.define('validateDepartmentOAuthAccess', departmentOAuthFunctions.validateDepartmentOAuthAccess);
    Parse.Cloud.define('getDepartmentOAuthAnalytics', departmentOAuthFunctions.getDepartmentOAuthAnalytics);

    // Register Apple OAuth Functions
    Parse.Cloud.define('initiateAppleOAuth', appleOAuthFunctions.initiateAppleOAuth);
    Parse.Cloud.define('handleAppleOAuthCallback', appleOAuthFunctions.handleAppleOAuthCallback);
    Parse.Cloud.define('getAppleOAuthConfig', appleOAuthFunctions.getAppleOAuthConfig);
    Parse.Cloud.define('revokeAppleOAuth', appleOAuthFunctions.revokeAppleOAuth);
    Parse.Cloud.define('handleAppleWebhook', appleOAuthFunctions.handleAppleWebhook);
    Parse.Cloud.define('getAppleUserData', appleOAuthFunctions.getAppleUserData);
    Parse.Cloud.define('validateAppleDomain', appleOAuthFunctions.validateAppleDomain);
    Parse.Cloud.define('getAppleOAuthAnalytics', appleOAuthFunctions.getAppleOAuthAnalytics);

    // Authentication Cloud Functions
    Parse.Cloud.define('getUserById', async (request) => {
      const { params, user } = request;
      const { userId } = params;

      try {
        // Allow superadmin/admin to get any user, others can only get their own
        if (user &amp;&amp; (user.get('role') === 'superadmin' || user.get('role') === 'admin' || user.id === userId)) {
          // Try AmexingUser first, then fallback to Parse.User
          const AmexingUserQuery = new Parse.Query('AmexingUser');
          AmexingUserQuery.equalTo('objectId', userId);

          let foundUser = await AmexingUserQuery.first({ useMasterKey: true });

          if (!foundUser) {
            const ParseUserQuery = new Parse.Query(Parse.User);
            ParseUserQuery.equalTo('objectId', userId);
            foundUser = await ParseUserQuery.first({ useMasterKey: true });
          }

          if (!foundUser) {
            throw new Parse.Error(Parse.Error.OBJECT_NOT_FOUND, 'User not found');
          }

          // Return sanitized user data
          return {
            id: foundUser.id,
            username: foundUser.get('username'),
            email: foundUser.get('email'),
            firstName: foundUser.get('firstName'),
            lastName: foundUser.get('lastName'),
            role: foundUser.get('role') || 'user',
            displayName: foundUser.get('displayName') || `${foundUser.get('firstName')} ${foundUser.get('lastName')}`,
            isActive: foundUser.get('isActive') !== false,
            emailVerified: foundUser.get('emailVerified') === true,
            lastLoginAt: foundUser.get('lastLoginAt'),
            createdAt: foundUser.get('createdAt'),
            updatedAt: foundUser.get('updatedAt'),
          };
        }
        throw new Parse.Error(Parse.Error.OPERATION_FORBIDDEN, 'Not authorized to access user data');
      } catch (error) {
        logger.error('Get user by ID error:', error);
        throw error;
      }
    });

    Parse.Cloud.define('registerUser', async (request) => {
      const { params, ip } = request;

      try {
        logger.info(`User registration attempt from IP: ${ip}`);

        const result = await AuthenticationService.registerUser(params);

        return result;
      } catch (error) {
        logger.error('Registration cloud function error:', error);
        throw error;
      }
    });

    Parse.Cloud.define('loginUser', async (request) => {
      const { params, ip } = request;
      const { identifier, password } = params;

      try {
        logger.info(`Login attempt for ${identifier} from IP: ${ip}`);

        const result = await AuthenticationService.loginUser(identifier, password);

        return result;
      } catch (error) {
        logger.error('Login cloud function error:', error);
        throw error;
      }
    });

    Parse.Cloud.define('refreshToken', async (request) => {
      const { params } = request;
      const { refreshToken } = params;

      try {
        const result = await AuthenticationService.refreshToken(refreshToken);
        return result;
      } catch (error) {
        logger.error('Token refresh cloud function error:', error);
        throw error;
      }
    });

    Parse.Cloud.define('changePassword', async (request) => {
      const { params, user } = request;
      const { currentPassword, newPassword } = params;

      if (!user) {
        throw new Parse.Error(Parse.Error.INVALID_SESSION_TOKEN, 'Authentication required');
      }

      try {
        const result = await AuthenticationService.changePassword(
          user.id,
          currentPassword,
          newPassword
        );
        return result;
      } catch (error) {
        logger.error('Password change cloud function error:', error);
        throw error;
      }
    });

    Parse.Cloud.define('initiatePasswordReset', async (request) => {
      const { params } = request;
      const { email } = params;

      try {
        const result = await AuthenticationService.initiatePasswordReset(email);
        return result;
      } catch (error) {
        logger.error('Password reset initiation error:', error);
        throw error;
      }
    });

    Parse.Cloud.define('resetPassword', async (request) => {
      const { params } = request;
      const { resetToken, newPassword } = params;

      try {
        const result = await AuthenticationService.resetPassword(resetToken, newPassword);
        return result;
      } catch (error) {
        logger.error('Password reset error:', error);
        throw error;
      }
    });

    // OAuth Cloud Functions
    Parse.Cloud.define('generateOAuthUrl', async (request) => {
      const { params } = request;
      const { provider, state } = params;

      try {
        const authUrl = await OAuthService.generateAuthorizationUrl(provider, state);
        return { authUrl };
      } catch (error) {
        logger.error('OAuth URL generation error:', error);
        throw error;
      }
    });

    Parse.Cloud.define('handleOAuthCallback', async (request) => {
      const { params, ip } = request;
      const { provider, code, state } = params;

      try {
        logger.info(`OAuth ${provider} callback from IP: ${ip}`);

        const result = await OAuthService.handleCallback(provider, code, state);
        return result;
      } catch (error) {
        logger.error('OAuth callback error:', error);
        throw error;
      }
    });

    Parse.Cloud.define('linkOAuthAccount', async (request) => {
      const { params, user } = request;
      const { provider, oauthData } = params;

      if (!user) {
        throw new Parse.Error(Parse.Error.INVALID_SESSION_TOKEN, 'Authentication required');
      }

      try {
        const result = await OAuthService.linkOAuthAccount(user.id, provider, oauthData);
        return result;
      } catch (error) {
        logger.error('OAuth account linking error:', error);
        throw error;
      }
    });

    Parse.Cloud.define('unlinkOAuthAccount', async (request) => {
      const { params, user } = request;
      const { provider } = params;

      if (!user) {
        throw new Parse.Error(Parse.Error.INVALID_SESSION_TOKEN, 'Authentication required');
      }

      try {
        const result = await OAuthService.unlinkOAuthAccount(user.id, provider);
        return result;
      } catch (error) {
        logger.error('OAuth account unlinking error:', error);
        throw error;
      }
    });

    Parse.Cloud.define('getOAuthProviders', async (request) => {
      try {
        const providers = OAuthService.getAvailableProviders();
        const providerConfigs = providers.map((provider) => OAuthService.getProviderConfig(provider));

        return { providers: providerConfigs };
      } catch (error) {
        logger.error('Get OAuth providers error:', error);
        throw error;
      }
    });

    // AmexingUser Triggers
    Parse.Cloud.beforeSave(AmexingUser, async (request) => {
      const { object: user, master } = request;

      // Skip validation for master key requests
      if (master) {
        return;
      }

      // Set default values for new users
      if (!user.existed()) {
        // Set createdAt and updatedAt if not set
        if (!user.get('createdAt')) {
          user.set('createdAt', new Date());
        }
        user.set('updatedAt', new Date());

        // Log user registration
        logger.logSecurityEvent('AMEXING_USER_REGISTRATION', {
          username: user.get('username'),
          email: user.get('email') ? `${user.get('email').substring(0, 3)}***` : undefined,
          role: user.get('role'),
          authMethod: user.get('primaryOAuthProvider') || 'password',
        });
      } else {
        // Update the updatedAt field
        user.set('updatedAt', new Date());

        logger.logSecurityEvent('AMEXING_USER_UPDATE', {
          userId: user.id,
          username: user.get('username'),
        });
      }

      // Validate required fields
      const requiredFields = ['username', 'email', 'firstName', 'lastName', 'role'];
      for (const field of requiredFields) {
        if (!user.get(field)) {
          throw new Parse.Error(Parse.Error.VALIDATION_ERROR, `${field} is required`);
        }
      }

      // Validate email format
      const email = user.get('email');
      if (email) {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(email)) {
          throw new Parse.Error(Parse.Error.VALIDATION_ERROR, 'Invalid email format');
        }
        // Normalize email to lowercase
        user.set('email', email.toLowerCase());
      }

      // Validate username format
      const username = user.get('username');
      if (username) {
        const usernameRegex = /^[a-zA-Z0-9_]{3,20}$/;
        if (!usernameRegex.test(username)) {
          throw new Parse.Error(
            Parse.Error.VALIDATION_ERROR,
            'Username must be 3-20 characters, alphanumeric and underscores only'
          );
        }
        // Normalize username to lowercase
        user.set('username', username.toLowerCase());
      }

      // Validate role
      const validRoles = ['user', 'client', 'employee', 'admin', 'superadmin'];
      const role = user.get('role');
      if (role &amp;&amp; !validRoles.includes(role)) {
        throw new Parse.Error(
          Parse.Error.VALIDATION_ERROR,
          `Invalid role. Must be one of: ${validRoles.join(', ')}`
        );
      }

      // Validate OAuth accounts format
      const oauthAccounts = user.get('oauthAccounts');
      if (oauthAccounts &amp;&amp; Array.isArray(oauthAccounts)) {
        for (const account of oauthAccounts) {
          if (!account.provider || !account.providerId) {
            throw new Parse.Error(
              Parse.Error.VALIDATION_ERROR,
              'OAuth accounts must have provider and providerId'
            );
          }
        }
      }
    });

    Parse.Cloud.afterSave(AmexingUser, async (request) => {
      const { object: user } = request;

      if (!user.existed()) {
        logger.info(`New AmexingUser created: ${user.id} (${user.get('username')})`);

        // Initialize any additional setup for new users
        // This could include creating related objects, sending welcome emails, etc.
      }
    });

    Parse.Cloud.beforeDelete(AmexingUser, async (request) => {
      const { object: user, master } = request;

      // Only allow user deletion with master key
      if (!master) {
        throw new Parse.Error(
          Parse.Error.OPERATION_FORBIDDEN,
          'AmexingUser can only be deleted with master key'
        );
      }

      logger.logSecurityEvent('AMEXING_USER_DELETION', {
        userId: user.id,
        username: user.get('username'),
        email: user.get('email') ? `${user.get('email').substring(0, 3)}***` : undefined,
      });
    });

    // Legacy Parse.User triggers (for backward compatibility if needed)
    Parse.Cloud.beforeSave(Parse.User, async (request) => {
      const { object: user, master } = request;

      // Skip validation for master key requests
      if (master) {
        return;
      }

      // Log legacy user operations
      if (!user.existed()) {
        logger.logSecurityEvent('LEGACY_USER_REGISTRATION', {
          username: user.get('username'),
          email: user.get('email') ? `${user.get('email').substring(0, 3)}***` : undefined,
        });
      }

      // Basic validation for legacy users
      if (!user.get('username')) {
        throw new Parse.Error(Parse.Error.VALIDATION_ERROR, 'Username is required');
      }

      const email = user.get('email');
      if (email) {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(email)) {
          throw new Parse.Error(Parse.Error.VALIDATION_ERROR, 'Invalid email format');
        }
      }
    });

    // After Save Triggers
    Parse.Cloud.afterSave(Parse.User, async (request) => {
      const { object: user } = request;

      if (!user.existed()) {
        logger.info(`New user created: ${user.id}`);

        // Initialize user profile or perform other setup tasks
        // This is where you might create related objects, send welcome emails, etc.
      }
    });

    // Before Delete Triggers
    Parse.Cloud.beforeDelete(Parse.User, async (request) => {
      const { object: user, master } = request;

      // Only allow user deletion with master key
      if (!master) {
        throw new Parse.Error(
          Parse.Error.OPERATION_FORBIDDEN,
          'Users can only be deleted with master key'
        );
      }

      logger.logSecurityEvent('USER_DELETION', {
        userId: user.id,
        username: user.get('username'),
      });
    });

    // After Login Trigger
    Parse.Cloud.afterLogin(async (request) => {
      const { object: user } = request;

      logger.logAccessAttempt(true, user.get('username'), request.ip);

      // Update last login timestamp
      user.set('lastLoginAt', new Date());
      await user.save(null, { useMasterKey: true });
    });

    // After Logout Trigger
    Parse.Cloud.afterLogout(async (request) => {
      const { object: session } = request;

      logger.logSecurityEvent('USER_LOGOUT', {
        sessionToken: `${session.get('sessionToken').substring(0, 8)}***`,
      });
    });

    // Job Functions (Scheduled Tasks)
    Parse.Cloud.job('cleanupExpiredSessions', async (request) => {
      const { message } = request;
      message('Starting expired sessions cleanup...');

      try {
        const Session = Parse.Object.extend('_Session');
        const query = new Parse.Query(Session);
        query.lessThan('expiresAt', new Date());

        const expiredSessions = await query.find({ useMasterKey: true });

        if (expiredSessions.length > 0) {
          await Parse.Object.destroyAll(expiredSessions, { useMasterKey: true });
          message(`Deleted ${expiredSessions.length} expired sessions`);
          logger.info(
            `Cleanup job: Deleted ${expiredSessions.length} expired sessions`
          );
        } else {
          message('No expired sessions found');
        }

        return { success: true, deletedCount: expiredSessions.length };
      } catch (error) {
        logger.error('Error in cleanup job:', error);
        throw error;
      }
    });

    // Security audit job
    Parse.Cloud.job('securityAudit', async (request) => {
      const { message } = request;
      message('Running security audit...');

      try {
        // Check for users with weak passwords (this is a placeholder)
        const User = Parse.Object.extend('_User');
        const query = new Parse.Query(User);
        const totalUsers = await query.count({ useMasterKey: true });

        // Check for users without email verification
        const unverifiedQuery = new Parse.Query(User);
        unverifiedQuery.equalTo('emailVerified', false);
        const unverifiedUsers = await unverifiedQuery.count({ useMasterKey: true });

        const auditResults = {
          totalUsers,
          unverifiedUsers,
          timestamp: new Date().toISOString(),
        };

        logger.logSecurityEvent('SECURITY_AUDIT', auditResults);
        message(
          `Audit complete. Total users: ${totalUsers}, Unverified: ${unverifiedUsers}`
        );

        return auditResults;
      } catch (error) {
        logger.error('Error in security audit:', error);
        throw error;
      }
    });

    logger.info('Cloud Code loaded successfully');
  } catch (error) {
    logger.error('Error registering cloud functions:', error);
  }
}

// The retry mechanism is not needed since Parse Server loads this file directly
// and Parse.Cloud is always available in this context

// Register cloud functions immediately
// Parse Server loads this file and Parse.Cloud is available
try {
  logger.info('Starting cloud functions registration...');
  registerCloudFunctions();
  logger.info('Cloud functions registration completed successfully');
} catch (error) {
  logger.error('Failed to register cloud functions:', error);
  logger.error('Cloud function registration error details:', {
    name: error.name,
    message: error.message,
    stack: error.stack,
  });
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="AdminController.html">AdminController</a></li><li><a href="AmexingAuthMiddleware.html">AmexingAuthMiddleware</a></li><li><a href="AmexingAuthService.html">AmexingAuthService</a></li><li><a href="AmexingUser.html">AmexingUser</a></li><li><a href="ApiController.html">ApiController</a></li><li><a href="AppleIdTokenValidator.html">AppleIdTokenValidator</a></li><li><a href="AppleOAuthService.html">AppleOAuthService</a></li><li><a href="AppleOAuthServiceCore.html">AppleOAuthServiceCore</a></li><li><a href="AppleSignInButton.html">AppleSignInButton</a></li><li><a href="AppleTokenExchanger.html">AppleTokenExchanger</a></li><li><a href="AuthController.html">AuthController</a></li><li><a href="AuthMiddleware.html">AuthMiddleware</a></li><li><a href="AuthenticationService.html">AuthenticationService</a></li><li><a href="AuthenticationServiceCore.html">AuthenticationServiceCore</a></li><li><a href="BaseController.html">BaseController</a></li><li><a href="Client.html">Client</a></li><li><a href="ClientController.html">ClientController</a></li><li><a href="CorporateOAuthInterface.html">CorporateOAuthInterface</a></li><li><a href="CorporateOAuthService.html">CorporateOAuthService</a></li><li><a href="CorporateSyncService.html">CorporateSyncService</a></li><li><a href="DashboardAuthMiddleware.html">DashboardAuthMiddleware</a></li><li><a href="DashboardController.html">DashboardController</a></li><li><a href="Department.html">Department</a></li><li><a href="DepartmentManagerController.html">DepartmentManagerController</a></li><li><a href="DepartmentOAuthFlowService.html">DepartmentOAuthFlowService</a></li><li><a href="DriverController.html">DriverController</a></li><li><a href="EmployeeController.html">EmployeeController</a></li><li><a href="GuestController.html">GuestController</a></li><li><a href="HomeController.html">HomeController</a></li><li><a href="IntelligentProviderSelector.html">IntelligentProviderSelector</a></li><li><a href="MobileOAuthOptimizer.html">MobileOAuthOptimizer</a></li><li><a href="NotificationsController.html">NotificationsController</a></li><li><a href="OAuthPermissionService.html">OAuthPermissionService</a></li><li><a href="OAuthProvider.html">OAuthProvider</a></li><li><a href="OAuthSecurityValidator.html">OAuthSecurityValidator</a></li><li><a href="OAuthService.html">OAuthService</a></li><li><a href="PermissionAuditService.html">PermissionAuditService</a></li><li><a href="PermissionContextService.html">PermissionContextService</a></li><li><a href="PermissionDelegationService.html">PermissionDelegationService</a></li><li><a href="PermissionInheritanceService.html">PermissionInheritanceService</a></li><li><a href="PermissionService.html">PermissionService</a></li><li><a href="RoleBasedController.html">RoleBasedController</a></li><li><a href="SecureSecretsManager.html">SecureSecretsManager</a></li><li><a href="SecurityMiddleware.html">SecurityMiddleware</a></li><li><a href="SuperAdminController.html">SuperAdminController</a></li><li><a href="UserManagementController.html">UserManagementController</a></li><li><a href="global.html#UserManagementService">UserManagementService</a></li><li><a href="ValidationMiddleware.html">ValidationMiddleware</a></li></ul><h3>Global</h3><ul><li><a href="global.html#BaseModel">BaseModel</a></li><li><a href="global.html#Parse">Parse</a></li><li><a href="global.html#about">about</a></li><li><a href="global.html#addCorporateDomain">addCorporateDomain</a></li><li><a href="global.html#authRateLimit">authRateLimit</a></li><li><a href="global.html#authenticateOptional">authenticateOptional</a></li><li><a href="global.html#authenticateToken">authenticateToken</a></li><li><a href="global.html#autoRefreshToken">autoRefreshToken</a></li><li><a href="global.html#checkUserPermission">checkUserPermission</a></li><li><a href="global.html#createEmergencyElevation">createEmergencyElevation</a></li><li><a href="global.html#createPermissionDelegation">createPermissionDelegation</a></li><li><a href="global.html#createPermissionOverride">createPermissionOverride</a></li><li><a href="global.html#crypto">crypto</a></li><li><a href="global.html#errorHandler">errorHandler</a></li><li><a href="global.html#express">express</a></li><li><a href="global.html#expressRateLimit">expressRateLimit</a></li><li><a href="global.html#extractUser">extractUser</a></li><li><a href="global.html#findUserById">findUserById</a></li><li><a href="global.html#generateCorporateOAuthURL">generateCorporateOAuthURL</a></li><li><a href="global.html#generateTokens">generateTokens</a></li><li><a href="global.html#getActiveDelegations">getActiveDelegations</a></li><li><a href="global.html#getAllSyncStatuses">getAllSyncStatuses</a></li><li><a href="global.html#getAppleOAuthAnalytics">getAppleOAuthAnalytics</a></li><li><a href="global.html#getAppleOAuthConfig">getAppleOAuthConfig</a></li><li><a href="global.html#getAppleUserData">getAppleUserData</a></li><li><a href="global.html#getAvailableContexts">getAvailableContexts</a></li><li><a href="global.html#getAvailableCorporateDomains">getAvailableCorporateDomains</a></li><li><a href="global.html#getAvailableDepartments">getAvailableDepartments</a></li><li><a href="global.html#getAvailablePermissions">getAvailablePermissions</a></li><li><a href="global.html#getCorporateClientDepartments">getCorporateClientDepartments</a></li><li><a href="global.html#getCorporateLandingConfig">getCorporateLandingConfig</a></li><li><a href="global.html#getCorporateSyncHistory">getCorporateSyncHistory</a></li><li><a href="global.html#getData">getData</a></li><li><a href="global.html#getDatabaseMetrics">getDatabaseMetrics</a></li><li><a href="global.html#getDelegatedPermissions">getDelegatedPermissions</a></li><li><a href="global.html#getDepartmentOAuthAnalytics">getDepartmentOAuthAnalytics</a></li><li><a href="global.html#getDepartmentOAuthConfig">getDepartmentOAuthConfig</a></li><li><a href="global.html#getDepartmentOAuthProviders">getDepartmentOAuthProviders</a></li><li><a href="global.html#getDepartmentPermissions">getDepartmentPermissions</a></li><li><a href="global.html#getErrorDetails">getErrorDetails</a></li><li><a href="global.html#getOAuthAuditLogs">getOAuthAuditLogs</a></li><li><a href="global.html#getOAuthProviderStatus">getOAuthProviderStatus</a></li><li><a href="global.html#getPermissionAuditReport">getPermissionAuditReport</a></li><li><a href="global.html#getPermissionAuditStats">getPermissionAuditStats</a></li><li><a href="global.html#getProviderDisplayName">getProviderDisplayName</a></li><li><a href="global.html#getRequestProperty">getRequestProperty</a></li><li><a href="global.html#getRolePermissions">getRolePermissions</a></li><li><a href="global.html#getSecretsManager">getSecretsManager</a></li><li><a href="global.html#getStatus">getStatus</a></li><li><a href="global.html#getSystemMetrics">getSystemMetrics</a></li><li><a href="global.html#getUserEffectivePermissions">getUserEffectivePermissions</a></li><li><a href="global.html#getUserPermissionInheritance">getUserPermissionInheritance</a></li><li><a href="global.html#getUserProfile">getUserProfile</a></li><li><a href="global.html#getVersion">getVersion</a></li><li><a href="global.html#gracefulShutdown">gracefulShutdown</a></li><li><a href="global.html#handleAppleOAuthCallback">handleAppleOAuthCallback</a></li><li><a href="global.html#handleAppleWebhook">handleAppleWebhook</a></li><li><a href="global.html#handleDepartmentOAuthCallback">handleDepartmentOAuthCallback</a></li><li><a href="global.html#handleMongoError">handleMongoError</a></li><li><a href="global.html#handleParseError">handleParseError</a></li><li><a href="global.html#handleValidationError">handleValidationError</a></li><li><a href="global.html#hasPermission">hasPermission</a></li><li><a href="global.html#https">https</a></li><li><a href="global.html#initialize">initialize</a></li><li><a href="global.html#initiateAppleOAuth">initiateAppleOAuth</a></li><li><a href="global.html#initiateDepartmentOAuth">initiateDepartmentOAuth</a></li><li><a href="global.html#jwt">jwt</a></li><li><a href="global.html#loadPrivateKey">loadPrivateKey</a></li><li><a href="global.html#logAccessAttempt">logAccessAttempt</a></li><li><a href="global.html#logDataAccess">logDataAccess</a></li><li><a href="global.html#logError">logError</a></li><li><a href="global.html#logSecurityEvent">logSecurityEvent</a></li><li><a href="global.html#logSystemChange">logSystemChange</a></li><li><a href="global.html#logger">logger</a></li><li><a href="global.html#login">login</a></li><li><a href="global.html#logout">logout</a></li><li><a href="global.html#optionalAuth">optionalAuth</a></li><li><a href="global.html#recordSuccessfulLogin">recordSuccessfulLogin</a></li><li><a href="global.html#register">register</a></li><li><a href="global.html#registerCloudFunctions">registerCloudFunctions</a></li><li><a href="global.html#requireRole">requireRole</a></li><li><a href="global.html#revokeAppleOAuth">revokeAppleOAuth</a></li><li><a href="global.html#revokePermissionDelegation">revokePermissionDelegation</a></li><li><a href="global.html#setRequestProperty">setRequestProperty</a></li><li><a href="global.html#showForgotPassword">showForgotPassword</a></li><li><a href="global.html#showLogin">showLogin</a></li><li><a href="global.html#showRegister">showRegister</a></li><li><a href="global.html#showResetPassword">showResetPassword</a></li><li><a href="global.html#startPeriodicSync">startPeriodicSync</a></li><li><a href="global.html#stopPeriodicSync">stopPeriodicSync</a></li><li><a href="global.html#switchPermissionContext">switchPermissionContext</a></li><li><a href="global.html#switchToDepartmentContext">switchToDepartmentContext</a></li><li><a href="global.html#testCorporateDomain">testCorporateDomain</a></li><li><a href="global.html#triggerCorporateSync">triggerCorporateSync</a></li><li><a href="global.html#updateUserProfile">updateUserProfile</a></li><li><a href="global.html#validateAppleDomain">validateAppleDomain</a></li><li><a href="global.html#validateCorporateLandingAccess">validateCorporateLandingAccess</a></li><li><a href="global.html#validateDepartmentOAuthAccess">validateDepartmentOAuthAccess</a></li><li><a href="global.html#validateLogin">validateLogin</a></li><li><a href="global.html#validateNewPassword">validateNewPassword</a></li><li><a href="global.html#validatePassword">validatePassword</a></li><li><a href="global.html#validatePasswordReset">validatePasswordReset</a></li><li><a href="global.html#validateRegistration">validateRegistration</a></li><li><a href="global.html#validateRequest">validateRequest</a></li><li><a href="global.html#validateUpdateProfile">validateUpdateProfile</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Wed Sep 24 2025 12:14:54 GMT-0600 (hora est√°ndar central)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
